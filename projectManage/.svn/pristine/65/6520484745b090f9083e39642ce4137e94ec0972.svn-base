/**
 * @author xujie
 * @date: 2018年1月15日 下午2:38:13 
 */
package com.linkGap.projectManage.controller;

import javax.servlet.http.HttpServletRequest;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.web.bind.annotation.DeleteMapping;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.PathVariable;
import org.springframework.web.bind.annotation.PostMapping;
import org.springframework.web.bind.annotation.PutMapping;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.context.request.RequestContextHolder;
import org.springframework.web.context.request.ServletRequestAttributes;

import com.linkGap.projectManage.model.ActiveUser;
import com.linkGap.projectManage.model.ReturnResultUtil;
import com.linkGap.projectManage.model.view.CustomerView;
import com.linkGap.projectManage.service.CustomerService;
import com.linkGap.projectManage.service.CustomerShopsService;

/**
 * @author xujie
 *
 */
@RestController
@RequestMapping(value = "customer")
public class CustomerController {
	
	
	@Autowired
	private CustomerService customerService;
	
	@Autowired
	private CustomerShopsService customerShopsService;
	
	/**
	 * 公司设置
	 * @author xujie
	 * @date: 2018年1月15日 下午4:56:50
	 */
	@GetMapping(value="/{userId}")
	public ReturnResultUtil queryCustomer(@PathVariable(value="userId")Integer userId){
		try {
			CustomerView view=this.customerService.queryCustomer(userId);
		} catch (Exception e) {
			e.printStackTrace();
			return new ReturnResultUtil("01", "修改失败");
		} 
		
		return new ReturnResultUtil("00", "修改成功");
	}
	
	/**
	 * 公司设置
	 * @author xujie
	 * @date: 2018年1月15日 下午4:56:50
	 */
	@PutMapping(value="/{customerId}")
	public ReturnResultUtil updateCustomer(@PathVariable(value="customerId")Integer customerId,String companyName,String mobile,String addressDetail,String picPist){
		try {
			HttpServletRequest request = ((ServletRequestAttributes)RequestContextHolder.getRequestAttributes()).getRequest();
			ActiveUser user = (ActiveUser) request.getSession().getAttribute("activeUser");
			this.customerService.update(customerId,companyName,mobile,addressDetail,picPist,user.getUserid());
		} catch (Exception e) {
			e.printStackTrace();
			return new ReturnResultUtil("01", "修改失败");
		} 
		
		return new ReturnResultUtil("00", "修改成功");
	}
	
	/**
	 * 添加门店
	 * @author xujie
	 * @date: 2018年1月15日 下午4:56:43
	 */
	@PostMapping(value="/customerShop")
	public ReturnResultUtil addCustomerShop(String shopName,Integer customerId){
		try {
			HttpServletRequest request = ((ServletRequestAttributes)RequestContextHolder.getRequestAttributes()).getRequest();
			ActiveUser user = (ActiveUser) request.getSession().getAttribute("activeUser");
			this.customerShopsService.addCustomerShop(customerId,shopName,user.getUserid());
		} catch (Exception e) {
			e.printStackTrace();
			return new ReturnResultUtil("01", "修改失败");
		} 
		return new ReturnResultUtil("00", "成功");
	}
	
	/**
	 * 删除门店
	 * @author xujie
	 * @date: 2018年1月15日 下午4:56:43
	 */
	@DeleteMapping(value="/customerShop")
	public ReturnResultUtil deleteCustomerShop(Integer customerId){
		try {
			HttpServletRequest request = ((ServletRequestAttributes)RequestContextHolder.getRequestAttributes()).getRequest();
			ActiveUser user = (ActiveUser) request.getSession().getAttribute("activeUser");
			this.customerShopsService.deleteCustomerShop(customerId,user.getUserid());
		} catch (Exception e) {
			e.printStackTrace();
			return new ReturnResultUtil("01", "修改失败");
		} 
		return new ReturnResultUtil("00", "成功");
	}
}
